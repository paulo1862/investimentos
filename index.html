<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Importar Planilha de Investimentos</title>
    <link rel="stylesheet" href="style.css">
    <!-- Biblioteca para ler Excel no Navegador -->
    <script src="cdn.sheetjs.com"></script>
    <style>
        .import-box { border: 2px dashed #004085; padding: 40px; text-align: center; border-radius: 15px; background: #fff; margin-bottom: 30px; cursor: pointer; }
        .resumo-cards { display: grid; grid-template-columns: repeat(auto-fit, min-minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card-resumo { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; }
        .corretora-tag { background: #e9ecef; padding: 3px 8px; border-radius: 5px; font-size: 0.8rem; font-weight: bold; }
    </style>
</head>
<body>

    <header class="header">
        <h1>Organizador de Planilha</h1>
        <a href="index.html" class="btn btn-refresh">Voltar ao Dashboard</a>
    </header>

    <div class="container">
        <!-- ÁREA DE UPLOAD -->
        <div class="card">
            <h2>Passo 1: Selecione seu arquivo Excel</h2>
            <div class="import-box" onclick="document.getElementById('fileInput').click()">
                <p>Clique aqui para selecionar a planilha que você baixou</p>
                <input type="file" id="fileInput" accept=".xlsx, .xls" style="display:none">
            </div>
        </div>

        <!-- RESUMO GERAL -->
        <div id="resultado-geral" style="display:none">
            <h2>Resultados Organizados</h2>
            <div class="resumo-cards" id="cards-container"></div>

            <div class="card">
                <h3>Detalhamento por Corretora</h3>
                <table id="tabela-importados">
                    <thead>
                        <tr>
                            <th>Corretora</th>
                            <th>Ativo</th>
                            <th>Qtd</th>
                            <th>Custo Total</th>
                        </tr>
                    </thead>
                    <tbody id="corpo-importacao"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                
                // Pega a primeira aba da planilha
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                
                processarDados(jsonData);
            };
            reader.readAsArrayBuffer(e.target.files[0]);
        });

        function processarDados(dados) {
            const containerCards = document.getElementById('cards-container');
            const corpoTabela = document.getElementById('corpo-importacao');
            const resultadoGeral = document.getElementById('resultado-geral');

            containerCards.innerHTML = '';
            corpoTabela.innerHTML = '';

            let totalGeral = 0;
            let corretoras = {};

            dados.forEach(linha => {
                // Ajuste os nomes das colunas de acordo com sua planilha
                const ativo = linha["Ativo"] || linha["Ticker"] || "N/A";
                const corretora = linha["Corretora"] || "Não Informada";
                const qtd = parseFloat(linha["Quantidade"] || 0);
                const custo = parseFloat(linha["Custo"] || linha["Valor"] || 0);

                totalGeral += custo;

                // Organiza por corretora
                if (!corretoras[corretora]) corretoras[corretora] = 0;
                corretoras[corretora] += custo;

                // Preenche a tabela
                corpoTabela.innerHTML += `
                    <tr>
                        <td><span class="corretora-tag">${corretora}</span></td>
                        <td><b>${ativo}</b></td>
                        <td>${qtd}</td>
                        <td>R$ ${custo.toLocaleString('pt-BR')}</td>
                    </tr>
                `;
            });

            // Cria os cards de resumo por corretora
            for (let cor in corretoras) {
                containerCards.innerHTML += `
                    <div class="card-resumo">
                        <small>${cor}</small>
                        <h3>R$ ${corretoras[cor].toLocaleString('pt-BR')}</h3>
                    </div>
                `;
            }

            resultadoGeral.style.display = 'block';
            alert("Planilha processada com sucesso!");
        }
    </script>
</body>
</html>
